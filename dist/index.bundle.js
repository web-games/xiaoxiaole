(()=>{"use strict";var t,e=(t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)});const n=function(t){function n(e){var o=t.call(this,e)||this;return n.NAME="application"+n.NUM++,o.view.style.width="100%",document.body.prepend(o.view),o}return e(n,t),Object.defineProperty(n.prototype,"stageWidth",{get:function(){return this.screen.width},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"stageHeight",{get:function(){return this.screen.height},enumerable:!1,configurable:!0}),n.NAME="application",n.NUM=0,n}(PIXI.Application);var o=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const r=function(t){function e(e){var n=t.call(this)||this;return n.game=null,n.stageWidth=0,n.stageHeight=0,n.game=e,n.stageWidth=e.stageWidth,n.stageHeight=e.stageHeight,n}return o(e,t),e.prototype.init=function(t){},e.prototype.destroy=function(){},e.prototype.removeAllChildren=function(t,e,n){if(void 0===t&&(t=this),void 0===e&&(e=!0),void 0===n&&(n=0),t){for(var o=t.children;o&&o.length;){var r=o.shift();this.removeAllChildren(r,!0,n+1)}e&&t.parent&&t.parent.removeChild(t)}},e}(PIXI.Container);var i=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=PIXI.Text,c=PIXI.Container,s=PIXI.Graphics;const u=function(t){function e(e){var n=t.call(this,e)||this;return n.loading=!0,n._loadingText=null,n._loadingBar=null,n}return i(e,t),e.prototype.init=function(){var t=this,n=new s;n.beginFill(window.themeColor),n.drawRect(0,0,this.stageWidth,this.stageHeight),n.endFill(),n.x=0,n.y=0,this.addChild(n),n.interactive=!0,n.on("pointerdown",(function(){!t.loading&&t.emit(e.CLICK_CONTINUE)})),n.name="screen_bg";var o=new c;this.addChild(o),o.x=(this.stageWidth-300)/2,o.y=this.stageHeight-300,o.name="loading_bar_container";var r=new s;r.lineStyle(2,16777215,1),r.beginFill(3308539,0),r.drawRoundedRect(0,0,300,16,8),r.endFill(),o.addChild(r);var i=new PIXI.filters.GlowFilter({distance:16,outerStrength:2,innerStrength:0,color:16777215,quality:.1,knockout:!1});r.filters=[i];var u=new s;u.beginFill(16777215,1),u.drawRect(0,0,300,16),u.endFill(),o.addChild(u),u.x=-300,u.y=0;var l=new s;l.beginFill(16711680,1),l.drawRoundedRect(0,0,300,16,8),l.endFill(),o.addChild(l),u.mask=l,this._loadingBar=u;var p=new a("加载中...",{fill:"#FFFFFF"});o.addChild(p),p.anchor.set(.5,.5),p.x=150,p.y=-30,this._loadingText=p,this.emit("init_complete")},e.prototype.setLoadingProgress=function(t){TweenMax.to(this._loadingBar,.3,{x:t/100*300-300}),this.setLoadingText("".concat(parseInt(t),"%"))},e.prototype.setLoadingText=function(t){this._loadingText.text=t},e.NAME="loading_scene",e.CLICK_CONTINUE="click_continue",e}(r);var l=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const p=function(t){function e(n){var o=t.call(this,e.NAME,n)||this;return o.loadingScene.on("init_complete",o.initComplete,o),o.loadingScene.on(u.CLICK_CONTINUE,(function(){o.sendNotification(K.TO_START,{from:o.loadingScene})}),o),o}return l(e,t),e.prototype.initComplete=function(){var t=this,e=new PIXI.Loader;e.add(["./resources/images/assets.json","./resources/images/animal1.png","./resources/images/animal2.png","./resources/images/animal3.png","./resources/images/animal4.png","./resources/images/animal5.png","./resources/images/animal6.png","./resources/images/animal7.png","./resources/images/animal8.png","./resources/images/sp_end_background.jpg","./resources/images/sp_main_background.jpg","./resources/images/sp_start_background.jpg"]),e.once("complete",(function(){t.loadingScene.setLoadingText("加载完成，点击任意地方继续"),t.loadingScene.loading=!1})),e.on("progress",(function(e){t.loadingScene.setLoadingProgress(e.progress)})),e.load(),PIXI.sound.add({worldscenebgm:"./resources/music/worldscenebgm.mp3",swap:"./resources/music/swap.mp3",click:"./resources/music/click.mp3",gamescenebgm:"./resources/music/gamescenebgm.mp3",drop:"./resources/music/drop.mp3"})},Object.defineProperty(e.prototype,"loadingScene",{get:function(){return this.viewComponent},enumerable:!1,configurable:!0}),e.NAME="loading_scene_mediator",e}(puremvc.Mediator);var f=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),h=PIXI.Container,d=PIXI.Text,y=PIXI.Graphics;const _=function(t){function e(e,n){void 0===e&&(e="");var o=t.call(this)||this,r=new y;o.addChild(r);var i=(null==n?void 0:n.fontSize)||32,a=(null==n?void 0:n.color)||16777215,c=new d(e,{fill:a,fontSize:i});c.anchor.set(.5,.5),o.addChild(c);var s=c.width+40,u=c.height+20,l=(null==n?void 0:n.bgColor)||window.themeColor;return r.beginFill(l),r.drawRoundedRect(-s/2,-u/2,s,u,8),r.endFill(),o.interactive=!0,o.on("pointerdown",(function(){PIXI.sound.play("click")})),o}return f(e,t),e}(h);var g=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),m=PIXI.Text;const v=function(t){function e(e){var n=t.call(this,e)||this;return n._ticker=null,n}return g(e,t),e.prototype.init=function(){var t=this;this.addBackground();var e=new m("开心消消乐",{fill:16777215,fontSize:64});e.anchor.set(.5,.5),e.x=this.stageWidth/2,e.y=this.stageHeight/2-160,this.addChild(e),e.name="txt1",e.rotation=-.05,TweenMax.to(e,.1,{rotation:.1,ease:Linear.easeNone,repeat:-1,yoyo:!0,delay:1});var n=new _("开始游戏");n.x=this.stageWidth/2,n.y=this.stageHeight/2,this.addChild(n),n.interactive=!0,n.on("pointerdown",(function(){return t.sceneOut()})),TweenMax.fromTo(e.scale,1,{x:0,y:0},{x:1,y:1,ease:Elastic.easeOut,delay:.3}),TweenMax.fromTo(n.scale,1,{x:0,y:0},{x:1,y:1,ease:Elastic.easeOut,delay:.45})},e.prototype.addBackground=function(){return t=this,e=void 0,o=function(){var t,e,n,o,r,i,a;return function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(c){switch(c.label){case 0:return t=this.stageWidth,e=this.stageHeight,[4,fetch("./resources/shader/smog.frag").then((function(t){return t.text()}))];case 1:return n=c.sent(),o={u_resolution:new PIXI.Point(t,e),alpha:1,shift:1.6,time:0,speed:new PIXI.Point(.1,.05)},r=new PIXI.Filter("",n,o),(i=PIXI.Sprite.from("./resources/images/pixi_v3_github-pad.png")).filters=[r],i.width=t,i.height=e,this.addChildAt(i,0),(a=new PIXI.Ticker).add((function(t){o.time+=.01})),a.start(),this._ticker=a,[2]}}))},new((n=void 0)||(n=Promise))((function(r,i){function a(t){try{s(o.next(t))}catch(t){i(t)}}function c(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}));var t,e,n,o},e.prototype.destroy=function(){this._ticker.stop()},e.prototype.sceneIn=function(){TweenMax.to(this,1,{alpha:1})},e.prototype.sceneOut=function(){var t=this;TweenMax.to(this,.3,{alpha:0,onComplete:function(){t.emit(e.CLICK_START)}})},e.NAME="start_scene",e.CLICK_START="click_start",e}(r);var w=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const T=function(t){function e(n){var o=t.call(this,e.NAME,n)||this;return o.startScene.on(v.CLICK_START,(function(){o.sendNotification(K.TO_GAME,{from:o.startScene})})),o}return w(e,t),e.prototype.listNotificationInterests=function(){return[]},e.prototype.handleNotification=function(t){t.getName()},Object.defineProperty(e.prototype,"startScene",{get:function(){return this.viewComponent},enumerable:!1,configurable:!0}),e.NAME="start_scene_mediator",e}(puremvc.Mediator);var C=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const b=function(t){function e(){var n=t.call(this,e.NAME)||this;return n.map=null,n.swapFruitStack=[],n.score=0,n._time=0,n.map=new I(n),n}return C(e,t),e.prototype.addSwapFruit=function(t){if(this.swapFruitStack.push(t),this.swapFruitStack.length>=2){var n=this.swapFruitStack[this.swapFruitStack.length-2],o=this.swapFruitStack[this.swapFruitStack.length-1];for(this.check4direction(n.row,n.col,o.row,o.col)?(PIXI.sound.play("swap"),this.map.swap(n.row,n.col,o.row,o.col),this.sendNotification(e.SWAP_FRUIT,[n,o],"success")):this.sendNotification(e.SWAP_FRUIT,[n,o],"fail");this.swapFruitStack.length;)this.swapFruitStack.shift()}},e.prototype.check4direction=function(t,e,n,o){return Math.abs(e-o)<=1&&t===n||Math.abs(t-n)<=1&&e===o},Object.defineProperty(e.prototype,"time",{get:function(){return this._time},set:function(t){this._time=t,this.sendNotification(e.CHANGE_TIME,this._time)},enumerable:!1,configurable:!0}),e.NAME="game_proxy",e.CHANGE_SCORE="change_score",e.CHANGE_TIME="change_time",e.ADD_FRUIT="add_fruit",e.DELETE_FRUIT="delete_fruit",e.DROP_FRUIT="drop_fruit",e.SWAP_FRUIT="swap_fruit",e}(puremvc.Proxy);var O=function(t,e,n){if(n||2===arguments.length)for(var o,r=0,i=e.length;r<i;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))};const I=function(){function t(t){this.rows=10,this.cols=5,this.data=[[2,4,2,4,2],[4,5,4,5,4],[4,5,5,5,4],[3,4,5,4,3],[1,1,4,1,1],[6,3,6,3,6],[3,7,3,7,3],[3,7,7,7,3],[2,3,7,3,2],[8,8,3,8,8]],this.proxy=null,this.proxy=t}return t.prototype.swap=function(t,e,n,o){var r=this,i=this.data[t][e];this.data[t][e]=this.data[n][o],this.data[n][o]=i,setTimeout((function(){r.check()}),300)},t.prototype.check=function(){var e=this,n=O(O([],this.horizontalCheck(),!0),this.verticalCheck(),!0).filter((function(t){return t}));if(console.log(n),n.length)PIXI.sound.play("drop"),n.forEach((function(t){var n=t[0],o=t[1];e.data[n][o]=null})),this.proxy.sendNotification(b.DELETE_FRUIT,n),setTimeout((function(){for(var t={},n=0;n<e.cols;n++){t[n]=[];for(var o,r=function(){if(null===e.data[i][n])for(var r=i;r--;)null!==e.data[r][n]&&((o=t[n].find((function(t){return t.row===r&&t.col===n})))||(o={row:r,col:n,drop:0},t[n].push(o)),o.drop++)},i=0;i<e.rows;i++)r();t[n].sort((function(t,e){return e.row-t.row}))}for(var a in t)t[a].forEach((function(t){var n=t.row,o=t.col,r=t.drop,i=e.data[n][o];e.data[n][o]=null,e.data[n+r][o]=i}));console.log(e.data),e.proxy.sendNotification(b.DROP_FRUIT,t),setTimeout((function(){e.check()}),300)}),1e3);else{for(var o=[],r=0;r<this.cols;r++)for(var i=0;i<this.rows;i++)null===this.data[i][r]&&(this.data[i][r]=this.getAnimalIndex(),o.push({row:i,col:r,value:this.data[i][r],animate:{from:{x:this.cols*t.GridWidth/2,y:0},to:{x:r*t.GridWidth+t.GridWidth/2,y:i*t.GridHeight+t.GridHeight/2}}}));o.length&&(this.proxy.sendNotification(b.ADD_FRUIT,o),this.check())}},t.prototype.horizontalCheck=function(){for(var t=[],e=0;e<this.rows;e++)for(var n=1,o=0;o<this.cols;o++){var r=this.data[e][o],i=this.data[e][o+1];if(null!=r||null!==i)if(r===i)n++;else{if(n>=3){this.proxy.score+=n,this.proxy.sendNotification(b.CHANGE_SCORE,this.proxy.score);for(var a=n,c="";a;){var s=e,u=o-(a-1);t.push([s,u]),c+="(".concat(s,",").concat(u,")"),a--}console.log("横向：连续".concat(n,"个相同").concat(c,",值为").concat(r))}n=1}}return t},t.prototype.verticalCheck=function(){for(var t=[],e=0;e<this.cols;e++)for(var n=1,o=0;o<this.rows;o++){var r=this.data[o][e],i=this.data[o+1]&&this.data[o+1][e]||null;if(null!=r||null!==i)if(r===i)n++;else{if(n>=3){this.proxy.score+=n,this.proxy.sendNotification(b.CHANGE_SCORE,this.proxy.score);for(var a=n,c="";a;){var s=o-(a-1),u=e;t.push([s,u]),c+="(".concat(s,",").concat(u,")"),a--}console.log("纵向：连续".concat(n,"个相同").concat(c,",值为").concat(r))}n=1}}return t},t.prototype.getAnimalIndex=function(){return parseInt(String(8*Math.random()))+1},t.GridWidth=80,t.GridHeight=80,t}();var S=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const x=function(t){function e(e,n,o){var r=t.call(this)||this;r.text=null,r.row=null,r.col=null,r.value=null,r.row=e,r.col=n,r.value=o;var i=PIXI.Sprite.from("./resources/images/animal".concat(o,".png"));r.addChild(i),i.anchor.set(.5);var a=new PIXI.Text("",{fontSize:10,fill:16777215});return r.addChild(a),a.anchor.set(.5,.5),r.text=a,r.buttonMode=!0,r.interactive=!0,r.update(),r}return S(e,t),e.prototype.setRowCol=function(t,e,n){void 0===n&&(n=!0),this.row=t,this.col=e,this.update();var o=e*I.GridWidth+I.GridWidth/2,r=t*I.GridHeight+I.GridHeight/2;n?TweenMax.to(this,.3,{x:o,y:r,ease:"none"}):(this.x=o,this.y=r)},e.prototype.update=function(){},e}(PIXI.Container);var A=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),E=PIXI.Container,P=PIXI.Graphics,N=PIXI.Sprite,M=PIXI.Text;const j=function(t){function e(e){var n=t.call(this,e)||this;return n.fruits={},n.timeText=null,n.scoreText=null,n.animalContainer=null,n}return A(e,t),e.prototype.init=function(e){var n=this;t.prototype.init.call(this,e),this.filters=[new PIXI.filters.GodrayFilter({alpha:.5})];var o=e.rows,r=e.cols,i=e.data;this.addChild(N.from("sp_main_background.jpg"));var a=new M("",{fill:16777215,fontSize:48});this.addChild(a),a.anchor.set(.5,0),a.x=this.stageWidth/4*1,a.y=10,a.filters=[new PIXI.filters.GlowFilter({color:65390,distance:15,innerStrength:.1,outerStrength:2.5})],this.timeText=a,this.updateTime(60);var c=new M("",{fill:16777215,fontSize:48});this.addChild(c),c.anchor.set(.5,0),c.x=this.stageWidth/4*3,c.y=10,c.filters=[new PIXI.filters.GlowFilter({color:65390,distance:15,innerStrength:.1,outerStrength:2.5})],this.scoreText=c,this.updateScore(0);var s=new E;this.addChild(s),s.x=(this.stageWidth-r*I.GridWidth)/2,s.y=(this.stageHeight-o*I.GridHeight)/2,this.animalContainer=s;var u=new P;s.addChild(u);for(var l=0;l<o;l++)for(var p=0;p<r;p++){var f=p*I.GridWidth,h=l*I.GridHeight;u.beginFill(0,l%2==0?p%2==0?.6:.4:p%2!=0?.6:.4),u.moveTo(f,h),u.lineTo(f+I.GridWidth,h),u.lineTo(f+I.GridWidth,h+I.GridHeight),u.lineTo(f,h+I.GridHeight),u.closePath(),u.endFill(),this.addFruit({row:l,col:p,value:i[l][p],animate:{from:{x:r*I.GridWidth/2,y:0},to:{x:p*I.GridWidth+I.GridWidth/2,y:l*I.GridHeight+I.GridHeight/2}}})}setTimeout((function(){n.emit("init_complete")}),1e3)},e.prototype.addFruit=function(t){var n=this;Array.isArray(t)||(t=[t]),t.forEach((function(t){var o=t.row,r=t.col,i=t.value,a=t.animate,c=new x(o,r,i);if(n.animalContainer.addChild(c),a){var s=a.from,u=a.to;TweenMax.fromTo([c],.3,s,u)}else c.x=r*I.GridWidth+I.GridWidth/2,c.y=o*I.GridHeight+I.GridHeight/2;c.on("pointerdown",(function(t){c.filters=[new PIXI.filters.OutlineFilter(2,10092441)],n.emit(e.CLICK_FRUIT,t.currentTarget)})),n.fruits["".concat(o,"_").concat(r)]=c}))},e.prototype.swapFruit=function(t,e){var n=t[0],o=t[1],r=n.row,i=n.col,a=o.row,c=o.col,s=this.fruits["".concat(r,"_").concat(i)],u=this.fruits["".concat(a,"_").concat(c)];"success"===e?(s.setRowCol(a,c),u.setRowCol(r,i),this.fruits["".concat(r,"_").concat(i)]=u,this.fruits["".concat(a,"_").concat(c)]=s,setTimeout((function(){s.filters=[],u.filters=[]}),300)):"fail"===e&&(s.rotation=-.05,u.rotation=-.05,TweenMax.to(s,.1,{rotation:.1,ease:Linear.easeNone,repeat:5,yoyo:!0}),TweenMax.to(u,.1,{rotation:.1,ease:Linear.easeNone,repeat:5,yoyo:!0}),setTimeout((function(){s.filters=[],u.filters=[]}),300))},e.prototype.deleteFruit=function(t){var e=this,n=[];t.forEach((function(t){n.find((function(e){return t[0]===e[0]&&t[1]===e[1]}))||n.push(t)})),n.forEach((function(t){var n=t[0],o=t[1],r=e.fruits["".concat(n,"_").concat(o)];TweenMax.to(r.scale,1,{x:0,y:0,ease:"power1.inOut"}),TweenMax.to(r,1,{alpha:0,ease:"none"}),e.fruits["".concat(n,"_").concat(o)]=null}))},e.prototype.dropFruit=function(t){var e=this;for(var n in t)t[n].forEach((function(t){var n=t.row,o=t.col,r=t.drop,i=e.fruits["".concat(n,"_").concat(o)];i.setRowCol(n+r,o),e.fruits["".concat(n,"_").concat(o)]=null,e.fruits["".concat(n+r,"_").concat(o)]=i}))},e.prototype.updateScore=function(t){this.scoreText.text="Score: "+t},e.prototype.updateTime=function(t){this.timeText.text="Time: "+t},e.NAME="game_scene",e.CLICK_FRUIT="click_fruit",e}(r);var R=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const k=function(t){function e(){return t.call(this)||this}return R(e,t),e.prototype.execute=function(t){var n=this;console.log("SceneCommand notification:",t);var o=t.getName(),r=t.getBody(),i=this.facade.retrieveProxy(b.NAME);switch(o){case e.ADD_FRUIT_STACK:i.addSwapFruit(r);break;case e.CHECK:i.map.check();break;case e.GAME_START:i.time=60;var a=setInterval((function(){i.time--,i.time<=0&&(a&&clearInterval(a),n.sendNotification(e.GAME_OVER))}),1e3);break;case e.GAME_OVER:var c=this.facade.retrieveMediator(G.NAME).gameScene;this.sendNotification(K.TO_END,{from:c})}},e.ADD_FRUIT_STACK="add_fruit_stack",e.CHECK="check",e.GAME_START="game_start",e.GAME_OVER="game_over",e}(puremvc.SimpleCommand);var F=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const G=function(t){function e(n){var o=t.call(this,e.NAME,n)||this;return o.gameScene.on("init_complete",(function(){o.sendNotification(k.CHECK)})),o.gameScene.on(j.CLICK_FRUIT,(function(t){var e=t.row,n=t.col,r=t.value;o.sendNotification(k.ADD_FRUIT_STACK,{row:e,col:n,value:r})})),o}return F(e,t),e.prototype.listNotificationInterests=function(){return[b.ADD_FRUIT,b.DELETE_FRUIT,b.DROP_FRUIT,b.SWAP_FRUIT,b.CHANGE_SCORE,b.CHANGE_TIME]},e.prototype.handleNotification=function(t){console.log("GameSceneMediator notification:",t);var e=t.getName(),n=t.getBody(),o=t.getType();switch(e){case b.ADD_FRUIT:this.gameScene.addFruit(n);break;case b.DELETE_FRUIT:this.gameScene.deleteFruit(n);break;case b.DROP_FRUIT:this.gameScene.dropFruit(n);break;case b.SWAP_FRUIT:this.gameScene.swapFruit(n,o);break;case b.CHANGE_SCORE:this.gameScene.updateScore(n);break;case b.CHANGE_TIME:this.gameScene.updateTime(n)}},Object.defineProperty(e.prototype,"gameScene",{get:function(){return this.viewComponent},enumerable:!1,configurable:!0}),e.NAME="game_scene_mediator",e}(puremvc.Mediator);var X=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),H=PIXI.Text;const W=function(t){function e(e){var n=t.call(this,e)||this;return n._ticker=null,n}return X(e,t),e.prototype.init=function(){var t=this;this.addBackground();var n=new H("游戏结束",{fill:16777215,fontSize:64});n.anchor.set(.5,.5),n.x=this.stageWidth/2,n.y=this.stageHeight/2-160,this.addChild(n);var o=new _("再来一次");o.x=this.stageWidth/2,o.y=this.stageHeight/2,o.interactive=!0,o.on("pointerdown",(function(){return t.emit(e.CLICK_AGAIN)})),this.addChild(o);var r=new _("重新开始");r.x=this.stageWidth/2,r.y=this.stageHeight/2+110,r.interactive=!0,r.on("pointerdown",(function(){return t.emit(e.CLICK_RESTART)})),this.addChild(r),TweenMax.fromTo(n.scale,1,{x:0,y:0},{x:1,y:1,ease:Elastic.easeOut,delay:.3}),TweenMax.fromTo(o.scale,1,{x:0,y:0},{x:1,y:1,ease:Elastic.easeOut,delay:.45}),TweenMax.fromTo(r.scale,1,{x:0,y:0},{x:1,y:1,ease:Elastic.easeOut,delay:.6})},e.prototype.addBackground=function(){return t=this,e=void 0,o=function(){var t,e,n,o,r,i,a;return function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(c){switch(c.label){case 0:return t=this.stageWidth,e=this.stageHeight,[4,fetch("./resources/shader/smog.frag").then((function(t){return t.text()}))];case 1:return n=c.sent(),o={u_resolution:new PIXI.Point(t,e),alpha:1,shift:1.6,time:0,speed:new PIXI.Point(.1,.05)},r=new PIXI.Filter("",n,o),(i=PIXI.Sprite.from("./resources/images/pixi_v3_github-pad.png")).filters=[r],i.width=t,i.height=e,this.addChildAt(i,0),(a=new PIXI.Ticker).add((function(t){o.time+=.01})),a.start(),this._ticker=a,[2]}}))},new((n=void 0)||(n=Promise))((function(r,i){function a(t){try{s(o.next(t))}catch(t){i(t)}}function c(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}));var t,e,n,o},e.prototype.destroy=function(){this._ticker.stop()},e.NAME="start_scene",e.CLICK_AGAIN="click_again",e.CLICK_RESTART="click_restart",e}(r);var U=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const D=function(t){function e(n){var o=t.call(this,e.NAME,n)||this;return o.endScene.on(W.CLICK_AGAIN,(function(){o.sendNotification(K.TO_GAME,{from:o.endScene})})),o.endScene.on(W.CLICK_RESTART,(function(){o.sendNotification(K.TO_START,{from:o.endScene})})),o}return U(e,t),e.prototype.listNotificationInterests=function(){return[]},e.prototype.handleNotification=function(t){t.getName()},Object.defineProperty(e.prototype,"endScene",{get:function(){return this.viewComponent},enumerable:!1,configurable:!0}),e.NAME="end_scene_mediator",e}(puremvc.Mediator);var L=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const K=function(t){function e(){return t.call(this)||this}return L(e,t),e.prototype.execute=function(t){console.log("SceneCommand notification:",t);var n=this.facade.application,o=t.getName(),r=t.getBody().from;switch(r&&(r.destroy(),r.removeAllChildren()),o){case e.TO_LOADING:var i=this.facade.retrieveMediator(p.NAME).loadingScene;n.stage.addChild(i),i.init();break;case e.TO_START:var a=this.facade.retrieveMediator(T.NAME).startScene;n.stage.addChild(a),a.sceneIn(),a.init(),PIXI.sound.stopAll(),PIXI.sound.play("worldscenebgm",{loop:!0});break;case e.TO_GAME:var c=this.facade.retrieveMediator(G.NAME).gameScene;n.stage.addChild(c),c.init(this.facade.retrieveProxy(b.NAME).map),this.sendNotification(k.GAME_START),PIXI.sound.stopAll(),PIXI.sound.play("gamescenebgm",{loop:!0});break;case e.TO_END:var s=this.facade.retrieveMediator(D.NAME).endScene;n.stage.addChild(s),s.init(),PIXI.sound.stop("gamescenebgm"),PIXI.sound.play("worldscenebgm",{loop:!0})}},e.TO_LOADING="to_loading",e.TO_START="to_start",e.TO_GAME="to_game",e.TO_END="to_end",e}(puremvc.SimpleCommand);var z=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const B=function(t){function e(){return t.call(this)||this}return z(e,t),e.prototype.execute=function(){this.facade.registerProxy(new b)},e}(puremvc.SimpleCommand);var V=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const q=function(t){function e(){return t.call(this)||this}return V(e,t),e.prototype.execute=function(t){var e=t.getBody(),n=new u(e);this.facade.registerMediator(new p(n));var o=new v(e);this.facade.registerMediator(new T(o));var r=new j(e);this.facade.registerMediator(new G(r));var i=new W(e);this.facade.registerMediator(new D(i))},e}(puremvc.SimpleCommand);var J=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const Q=function(t){function e(){return t.call(this)||this}return J(e,t),e.prototype.execute=function(){this.facade.registerCommand(K.TO_LOADING,K),this.facade.registerCommand(K.TO_START,K),this.facade.registerCommand(K.TO_GAME,K),this.facade.registerCommand(K.TO_END,K),this.facade.registerCommand(k.GAME_START,k),this.facade.registerCommand(k.GAME_OVER,k),this.facade.registerCommand(k.CHECK,k),this.facade.registerCommand(k.ADD_FRUIT_STACK,k)},e}(puremvc.SimpleCommand);var Y=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const Z=function(t){function e(){return t.call(this)||this}return Y(e,t),e.prototype.initializeMacroCommand=function(){this.addSubCommand(B),this.addSubCommand(q),this.addSubCommand(Q)},e}(puremvc.MacroCommand);var $=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),tt=puremvc.Facade;const et=function(t){function e(e){var n=t.call(this,e)||this;return n._application=null,n}return $(e,t),e.getInstance=function(t){return null==t?null:(null==tt.instanceMap[t]&&(tt.instanceMap[t]=new e(t)),tt.instanceMap[t])},e.prototype.initializeModel=function(){t.prototype.initializeModel.call(this)},e.prototype.initializeView=function(){t.prototype.initializeView.call(this)},e.prototype.initializeController=function(){t.prototype.initializeController.call(this),this.registerCommand(e.STARTUP,Z)},e.prototype.startup=function(){var t=document.documentElement.clientWidth||document.body.clientWidth,o=document.documentElement.clientHeight||document.body.clientHeight,r=o>t?o/t*640:t/o*640;globalThis.__PIXI_APP__=this.application=new n({width:640,height:r,backgroundColor:window.themeColor}),this.sendNotification(e.STARTUP,this.application),this.removeCommand(e.STARTUP),this.sendNotification(K.TO_LOADING,{from:null})},e.prototype.destroy=function(){this.application&&(this.application.destroy(!0),this.application=null),TweenMax.killAll()},Object.defineProperty(e.prototype,"application",{get:function(){return this._application},set:function(t){this._application=t},enumerable:!1,configurable:!0}),e.STARTUP="startup",e.instance=null,e}(tt);window.themeColor=7721978,et.getInstance(n.NAME).startup()})();